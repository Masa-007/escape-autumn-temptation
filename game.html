<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>EAT - ESCAPE AUTUMN TEMPTATION</title>
<style>

  body {
    text-align: center;
    font-family: "Segoe UI", "Helvetica", sans-serif;
    background: url("./assets/images/back.image.png") no-repeat center top;
    background-size: cover;
    background-attachment: fixed;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
  }

  canvas {
    aspect-ratio: 525 / 600;
    width: 90vw;
    max-width: 525px;
    border: 1px solid #000;
    display: block;
    margin: 15px auto;
    cursor: pointer;
  }

  button {
    margin: 10px 0;
    padding: 12px 30px;
    font-size: 18px;
    font-weight: bold;
    color: #fff;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    transition: all 0.2s ease-in-out;
  }

  button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
  }

  /* 上部BGMボタン */
  #bgmToggleBtn { color: #fff; }

  /* スタート／再挑戦ボタン */
  #startBtn, #restartBtn {
    background: linear-gradient(135deg, #d72631, #ff4e50);
    color: #fff;
    box-shadow: 0 5px 15px rgba(215,38,49,0.5);
  }

  #startBtn:hover, #restartBtn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(215,38,49,0.7);
  }

  /* タイマー */
  #timerContainer {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: 6px;
    row-gap: 2px;
    margin: 5px 0;
    font-size: 30px;
    font-weight: bold;
    color: #ff4d4d;
    text-shadow: 2px 2px 12px #fff, 0 0 15px #ff9999;
    background: rgba(255, 255, 255, 0.2);
    padding: 4px 14px;
    border-radius: 15px;
    animation: pulse 1s infinite alternate;
    line-height: 1;
  }

  #timerContainer span {
    margin: 0;
    padding: 0;
    display: inline-block;
    line-height: 1;
  }

  /* ゲームオーバー表示 */
  #gameOver {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(0,0,0,0.8);
    color: white;
    padding: 30px 50px;
    border-radius: 20px;
    text-align: center;
    z-index: 100;
  }

  /* ゲームオーバー ボタン群 */
  #gameOver .gameOverButtons {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    margin-top: 15px;
  }

  #gameOver button,
  #gameOver a {
    width: 80%;
    max-width: 300px;
    padding: 12px 0;
    border-radius: 10px;
    font-weight: bold;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    transition: all 0.2s ease-in-out;
    display: block;
  }

  #gameOver button:hover,
  #gameOver a:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
  }

  #restartBtn {
    background: linear-gradient(135deg, #d72631, #ff4e50);
    color: #fff;
    box-shadow: 0 5px 15px rgba(215,38,49,0.5);
  }

  #changeBgmBtn {
    background: linear-gradient(135deg, #f4a261, #e9c46a);
    color: #fff;
    box-shadow: 0 5px 15px rgba(244,162,97,0.5);
  }

  #shareX {
    background: linear-gradient(135deg, #4c6ef5, #15aabf);
    color: #fff;
    text-decoration: none;
  }

  #viewEndingBtn {
    background: linear-gradient(135deg, #ffd700, #ffb700);
    color: #000;
    box-shadow: 0 5px 15px rgba(255,215,0,0.5);
  }

  @media (max-width: 768px) {
    button { font-size: 16px; padding: 10px 25px; }
    #timerContainer { font-size: 32px; padding: 4px 10px; }
    #gameOver { font-size: 20px; padding: 20px 30px; }
  }
</style>
</head>

<body>
  <!-- BGM切替ボタン -->
  <button id="bgmToggleBtn">ナウなBGM</button>

  <!-- ゲームキャンバス -->
  <canvas id="gameCanvas" width="525" height="600"></canvas>

  <!-- タイマー -->
  <p id="timerContainer"><span>あと</span><span id="timer">60秒</span></p>

  <!-- スタートボタン -->
  <button id="startBtn">修行開始ィ!!</button>

  <!-- ゲームオーバーバナー -->
  <div id="gameOver">
    <h2 id="resultText">耐えた時間: 0秒</h2>
    <div class="gameOverButtons">
      <button id="restartBtn">再挑戦するぜｯ!!</button>
      <button id="changeBgmBtn">BGMを変更する</button>
      <a id="shareX" href="#" target="_blank" style="display:none;">Xで結果を共有だッ!!</a>
      <button id="viewEndingBtn" style="display:none;">エンディングを観る</button>
    </div>
  </div>

  <!-- 非表示で読み込む画像 -->
  <img id="playerImg" src="./assets/images/character.png" style="display: none" />
  <img id="waterfallImg" src="./assets/images/waterfall.png" style="display: none" />

  <script type="module">
    import { initGame, startGame, restartGame, showGameOver } from "./js/main.js";
    import { toggleBgm, updateBgmButton } from "./js/bgm.js";

    // 初期化
    initGame();
    updateBgmButton(); // 初回から正しい色とラベルを反映

    const startBtn = document.getElementById("startBtn");
    const restartBtn = document.getElementById("restartBtn");
    const gameOverEl = document.getElementById("gameOver");
    const changeBgmBtn = document.getElementById("changeBgmBtn");
    const bgmToggleBtn = document.getElementById("bgmToggleBtn");

    startBtn.addEventListener("click", () => startGame());
    restartBtn.addEventListener("click", () => restartGame());
    changeBgmBtn.addEventListener("click", () => toggleBgm());
    bgmToggleBtn.addEventListener("click", () => toggleBgm());

    // Enterキーで開始／再挑戦
    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        if (!window.gameStarted) {
          startBtn.click();
        } else if (gameOverEl.style.display === "block") {
          restartBtn.click();
        }
      }
    });
  </script>
</body>
</html>
